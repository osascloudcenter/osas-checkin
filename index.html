<script>
  const tg = window.Telegram.WebApp;
  const btn = document.getElementById("btn");
  const status = document.getElementById("status");

  btn.onclick = () => {

    btn.disabled = true;
    btn.innerText = "â³ Mengambil lokasi...";
    status.innerText = "ğŸ“¡ Mengakses GPS...";

    navigator.geolocation.getCurrentPosition(

      pos => {

        const data = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          time: Date.now()
        };

        btn.innerText = "â³ Mengirim...";
        status.innerText = "ğŸ“¤ Mengirim data ke server...";

        tg.sendData(JSON.stringify(data));

        // Tampilkan sukses dulu
        setTimeout(() => {
          status.innerText = "âœ… Check-in berhasil";
          btn.innerText = "Selesai";
        }, 300);

        // Tutup otomatis
        setTimeout(() => {
          tg.close();
        }, 900);

      },

      err => {

        btn.disabled = false;
        btn.innerText = "ğŸ“ Check-in Sekarang";
        status.innerText = "âŒ GPS tidak aktif";

        alert("Mohon aktifkan GPS untuk melakukan check-in");

      }

    );

  };
</script>
